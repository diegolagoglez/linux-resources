#!/bin/bash

PROJECT_DIR=.
GIT_DIR=.git

function find_git_base_dir() {
	PROJECT_DIR=$(pwd)
	while [ ! -d $PROJECT_DIR/$GIT_DIR -a $PROJECT_DIR != '/' ]; do
		PROJECT_DIR=$(dirname $PROJECT_DIR)
	done
}

function check_git_dir() {
	if [ ! -d $GIT_DIR ]; then
		find_git_base_dir
		if [ "$PROJECT_DIR" == "/" ]; then
			echo "ERROR: Not in a Git repository: $(pwd)"
			exit 1
		fi
	fi
}

function sizes() {
	if [ "$2" != "" ]; then
		size=$(du -hs $1 --exclude $2)
		bsize=$(du -s --block-size=1 $1 --exclude $2)
	else
		size=$(du -hs $1)
		bsize=$(du -s --block-size=1 $1)
	fi
	repo_size=$(echo $size | cut -d' ' -f1)
	repo_bsize=$(echo $bsize | cut -d' ' -f1)
}

check_git_dir

sizes $PROJECT_DIR
echo "Total size   : $repo_size ($repo_bsize B)"

sizes $PROJECT_DIR/$GIT_DIR
echo "Git dir size : $repo_size ($repo_bsize B)"

sizes $PROJECT_DIR $GIT_DIR
echo "Project size : $repo_size ($repo_bsize B)"

